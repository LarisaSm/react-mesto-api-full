{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _toConsumableArray from\"/Users/lara/Documents/\\u043E\\u0431\\u0443\\u0447\\u0435\\u043D\\u0438\\u0435/\\u043F\\u0440\\u043E\\u0433\\u0440\\u0430\\u043C\\u043C\\u0438\\u0440\\u043E\\u0432\\u0430\\u043D\\u0438\\u0435/yaPractik/mesto-all/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/lara/Documents/\\u043E\\u0431\\u0443\\u0447\\u0435\\u043D\\u0438\\u0435/\\u043F\\u0440\\u043E\\u0433\\u0440\\u0430\\u043C\\u043C\\u0438\\u0440\\u043E\\u0432\\u0430\\u043D\\u0438\\u0435/yaPractik/mesto-all/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useCallback}from\"react\";import ImagePopup from\"./ImagePopup\";import Confirm from\"./Confirm\";import{getInitialCards,addNewCard,editUserInfo,getUserInfo,deleteCard,likeCard,deleteLikeCard,getLikesCard,setUserAvatar}from\"../utils/api\";import Login from\"./Login\";import Register from\"./Register\";import ProtectedRoute from\"./ProtectedRoute\";import PageNotFound from\"./PageNotFound\";import*as auth from\"../utils/auth\";import InfoTooltip from\"./InfoTooltip\";import{Route,Switch,useHistory}from\"react-router-dom\";import Header from\"./Header\";import Footer from\"./Footer\";import Main from\"./Main\";import EditProfilePopup from\"./EditProfilePopup\";import EditAvatarPopup from\"./EditAvatarPopup\";import AddPlacePopup from\"./AddPlacePopup\";import CurrentUserContext from\"../contexts/CurrentUserContext\";function App(){var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),isEditProfilePopupOpen=_React$useState2[0],setEditProfilePopupState=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),isEditAvatarPopupOpen=_React$useState4[0],setEditAvatarPopupState=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isAddPlacePopupOpen=_React$useState6[0],setAddPlacerPopupState=_React$useState6[1];var _React$useState7=React.useState(false),_React$useState8=_slicedToArray(_React$useState7,2),isImagePopupOpen=_React$useState8[0],setImagePopupState=_React$useState8[1];var _React$useState9=React.useState(false),_React$useState10=_slicedToArray(_React$useState9,2),isConfirmOpen=_React$useState10[0],setConfirmOpen=_React$useState10[1];var _React$useState11=React.useState(false),_React$useState12=_slicedToArray(_React$useState11,2),isInfoTooltipOpen=_React$useState12[0],setInfoTooltipOpen=_React$useState12[1];var _React$useState13=React.useState(false),_React$useState14=_slicedToArray(_React$useState13,2),isConfirmAuth=_React$useState14[0],setConfirmAuth=_React$useState14[1];var _React$useState15=React.useState([]),_React$useState16=_slicedToArray(_React$useState15,2),cards=_React$useState16[0],setCards=_React$useState16[1];var _React$useState17=React.useState(false),_React$useState18=_slicedToArray(_React$useState17,2),isLoading=_React$useState18[0],setIsLoading=_React$useState18[1];var _React$useState19=React.useState({src:\"\",nameImg:\"\"}),_React$useState20=_slicedToArray(_React$useState19,2),selectedCard=_React$useState20[0],setSelectedCard=_React$useState20[1];var _React$useState21=React.useState(false),_React$useState22=_slicedToArray(_React$useState21,2),isLoadingConfirm=_React$useState22[0],setIsLoadingConfirm=_React$useState22[1];var _React$useState23=React.useState(false),_React$useState24=_slicedToArray(_React$useState23,2),isLoadingPopup=_React$useState24[0],setIsLoadingPopup=_React$useState24[1];var _React$useState25=React.useState({name:\"\",about:\"\",email:\"\",token:\"\"}),_React$useState26=_slicedToArray(_React$useState25,2),currentUser=_React$useState26[0],setСurrentUser=_React$useState26[1];var _React$useState27=React.useState(),_React$useState28=_slicedToArray(_React$useState27,2),currentUserHeaders=_React$useState28[0],setCurrentUserHeaders=_React$useState28[1];var _React$useState29=React.useState({ownerId:\"\",cardId:\"\"}),_React$useState30=_slicedToArray(_React$useState29,2),currentCard=_React$useState30[0],setСurrentCard=_React$useState30[1];// const [userData, setUserData] = React.useState({});\nvar _React$useState31=React.useState({}),_React$useState32=_slicedToArray(_React$useState31,2),confirmAction=_React$useState32[0],setConfirmAction=_React$useState32[1];var history=useHistory();var _React$useState33=React.useState(false),_React$useState34=_slicedToArray(_React$useState33,2),loggedIn=_React$useState34[0],setLoggedIn=_React$useState34[1];// React.useEffect(() => {\n//   console.log('123123123123');\n//   tokenCheck();\n//   console.log()\n// }, []);\nReact.useEffect(function(){getUserInfo(currentUserHeaders).then(function(res){setСurrentUser(res);}).catch(function(err){console.log(err);// выведем ошибку в консоль\n});},[currentUserHeaders]);React.useEffect(function(){getInitialCards(currentUserHeaders).then(function(res){setCards(res.map(function(item){return{src:item.link,nameImg:item.name,like:item.likes,cardId:item._id,ownerId:item.owner};}));setIsLoading(false);}).catch(function(err){console.log(err);// выведем ошибку в консоль\n});},[currentUserHeaders]);function closeAllPopups(){setEditProfilePopupState(false);setEditAvatarPopupState(false);setAddPlacerPopupState(false);setImagePopupState(false);setInfoTooltipOpen(false);setSelectedCard([]);setIsLoadingPopup(false);setСurrentCard({ownerId:\"\",cardId:\"\"});}function handleCardClick(_ref){var src=_ref.src,nameImg=_ref.nameImg;setSelectedCard({src:src,nameImg:nameImg});setImagePopupState(true);}function handleConfirmClick(){setConfirmOpen(true);}function handleEditProfileClick(evt){evt.preventDefault();setEditProfilePopupState(true);}function handleEditAvatarClick(e){e.preventDefault();setEditAvatarPopupState(true);}function handleAddPlaceClick(evt){evt.preventDefault();setAddPlacerPopupState(true);}function cardDelete(){var isOwn=currentCard.ownerId===currentUser._id;if(isOwn){deleteCard(currentCard.cardId,currentUserHeaders).then(function(){var newCards=cards.filter(function(c){return c.cardId!==currentCard.cardId;});setCards(newCards);}).then(function(){setConfirmOpen(false);setIsLoadingConfirm(false);}).catch(function(err){console.log(err);// выведем ошибку в консоль\n});}}function handleCardDelete(obj){setConfirmAction(\"cardDelete\");setСurrentCard({ownerId:obj.ownerId,cardId:obj.cardId});}function handleCardLike(like,cardId){// Снова проверяем, есть ли уже лайк на этой карточке\nvar isLiked=like.some(function(i){return i===currentUser._id;});// console.log('main -> handleCardLike');\nif(!isLiked){// console.log(\"main -> handleCardLike -> like\")\nlikeCard(cardId,currentUserHeaders).then(function(newCard){var newCards=cards.map(function(c){return c.cardId===newCard._id?{src:newCard.link,nameImg:newCard.name,like:newCard.likes,cardId:newCard._id,ownerId:newCard.owner}:c;});setCards(newCards);}).catch(function(err){console.log(err);// выведем ошибку в консоль\n});}else{// console.log(\"main -> handleCardLike -> deleteLike\")\ndeleteLikeCard(cardId,currentUserHeaders).then(function(newCard){var newCards=cards.map(function(c){return c.cardId===newCard._id?{src:newCard.link,nameImg:newCard.name,like:newCard.likes,cardId:newCard._id,ownerId:newCard.owner}:c;});setCards(newCards);}).catch(function(err){console.log(err);// выведем ошибку в консоль\n});}}function handleUpdateUser(name,about){setIsLoadingPopup(true);editUserInfo(name,about,currentUserHeaders).then(function(res){return setСurrentUser(res);}).then(function(){setIsLoadingPopup(false);setEditProfilePopupState(false);}).catch(function(err){console.log(err);// выведем ошибку в консоль\n});}function handleUpdateAvatar(obj){setIsLoadingPopup(true);setUserAvatar(obj.avatar,currentUserHeaders).then(function(res){return setСurrentUser(res);}).then(function(){setIsLoadingPopup(false);setEditAvatarPopupState(false);}).catch(function(err){console.log(err);// выведем ошибку в консоль\n});}function handleAddPlaceSubmit(obj){setIsLoadingPopup(true);addNewCard(obj.name,obj.link,currentUserHeaders).then(function(newCard){newCard.key=newCard._id;newCard.like=newCard.likes;newCard.ownerId=newCard.owner;newCard.src=newCard.link;newCard.nameImg=newCard.name;newCard.cardId=newCard._id;setCards([newCard].concat(_toConsumableArray(cards)));}).then(function(){setIsLoadingPopup(false);setAddPlacerPopupState(false);}).catch(function(err){console.log(err);// выведем ошибку в консоль\n});}function handleLogin(inputEmailValue,inputPassValue){auth.authorize(inputPassValue,inputEmailValue).then(function(data){if(data.token){setLoggedIn(true);// setUserData({ email: inputEmailValue });\nsetСurrentUser({email:inputEmailValue});setCurrentUserHeaders(data.token);history.push(\"/\");}}).catch(function(err){console.log(err);});}function handleRegister(inputPassValue,inputEmailValue){auth.register(inputPassValue,inputEmailValue).then(function(data){if(data._id){setConfirmAuth(true);history.push(\"/sign-in\");}setInfoTooltipOpen(true);}).catch(function(err){console.log(err);setConfirmAuth(false);setInfoTooltipOpen(true);});}function signOut(){localStorage.removeItem(\"jwt\");history.push(\"/sign-in\");}function tokenCheck(){// если у пользователя есть токен в localStorage,\n// эта функция проверит валидность токена\nvar jwt=localStorage.getItem(\"jwt\");if(jwt){// проверим токен\nauth.getContent(jwt).then(function(res){console.log(res);if(res){// авторизуем пользователя\nsetLoggedIn(true);// setUserData({ email: res.data.email });\nsetСurrentUser({email:res.email});setCurrentUserHeaders(jwt);// обернём App.js в withRouter\n// так, что теперь есть доступ к этому методу\nhistory.push(\"/\");}}).catch(function(err){console.log(err);// выведем ошибку в консоль\n});}}React.useEffect(function(){setIsLoading(true);tokenCheck();getInitialCards(currentUserHeaders).then(function(res){setCards(res.map(function(item){return{src:item.link,nameImg:item.name,like:item.likes,cardId:item._id,ownerId:item.owner};}));setIsLoading(false);}).catch(function(err){console.log(err);// выведем ошибку в консоль\n});},[]);return/*#__PURE__*/_jsx(CurrentUserContext.Provider,{value:currentUser,children:/*#__PURE__*/_jsxs(\"div\",{className:\"App\",children:[/*#__PURE__*/_jsx(Header,{loggedIn:loggedIn,userData:currentUser,signOut:signOut}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(ProtectedRoute,{exact:true,path:\"/\",component:Main,loggedIn:loggedIn,cards:cards,onEditProfile:function onEditProfile(e){return handleEditProfileClick(e);},onEditAvatar:function onEditAvatar(e){return handleEditAvatarClick(e);},onAddPlace:function onAddPlace(e){return handleAddPlaceClick(e);},onCardClick:handleCardClick,setConfirmOpen:handleConfirmClick,onCardLike:handleCardLike,onCardDelete:handleCardDelete,isLoading:isLoading}),/*#__PURE__*/_jsx(Route,{path:\"/sign-in\",children:/*#__PURE__*/_jsx(Login,{onLogin:handleLogin})}),/*#__PURE__*/_jsx(Route,{path:\"/sign-up\",children:/*#__PURE__*/_jsx(Register,{onRegister:handleRegister})}),/*#__PURE__*/_jsx(Route,{path:\"*\",children:/*#__PURE__*/_jsx(PageNotFound,{})})]}),/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser,isLoadingPopup:isLoadingPopup}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar,isLoadingPopup:isLoadingPopup}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit,isLoadingPopup:isLoadingPopup}),/*#__PURE__*/_jsx(Confirm,{isOpen:isConfirmOpen,setIsOpen:setConfirmOpen,confirmAction:confirmAction,setСurrentUser:setСurrentUser,isLoadingConfirm:isLoadingConfirm,setIsLoadingConfirm:setIsLoadingConfirm,cardDelete:cardDelete}),/*#__PURE__*/_jsx(ImagePopup,{card:selectedCard,isOpen:isImagePopupOpen,onClose:closeAllPopups}),/*#__PURE__*/_jsx(InfoTooltip,{isOpen:isInfoTooltipOpen,onClose:closeAllPopups,isConfirmAuth:isConfirmAuth})]})});}export default App;","map":{"version":3,"sources":["/Users/lara/Documents/обучение/программирование/yaPractik/mesto-all/frontend/src/components/App.js"],"names":["React","useCallback","ImagePopup","Confirm","getInitialCards","addNewCard","editUserInfo","getUserInfo","deleteCard","likeCard","deleteLikeCard","getLikesCard","setUserAvatar","Login","Register","ProtectedRoute","PageNotFound","auth","InfoTooltip","Route","Switch","useHistory","Header","Footer","Main","EditProfilePopup","EditAvatarPopup","AddPlacePopup","CurrentUserContext","App","useState","isEditProfilePopupOpen","setEditProfilePopupState","isEditAvatarPopupOpen","setEditAvatarPopupState","isAddPlacePopupOpen","setAddPlacerPopupState","isImagePopupOpen","setImagePopupState","isConfirmOpen","setConfirmOpen","isInfoTooltipOpen","setInfoTooltipOpen","isConfirmAuth","setConfirmAuth","cards","setCards","isLoading","setIsLoading","src","nameImg","selectedCard","setSelectedCard","isLoadingConfirm","setIsLoadingConfirm","isLoadingPopup","setIsLoadingPopup","name","about","email","token","currentUser","setСurrentUser","currentUserHeaders","setCurrentUserHeaders","ownerId","cardId","currentCard","setСurrentCard","confirmAction","setConfirmAction","history","loggedIn","setLoggedIn","useEffect","then","res","catch","err","console","log","map","item","link","like","likes","_id","owner","closeAllPopups","handleCardClick","handleConfirmClick","handleEditProfileClick","evt","preventDefault","handleEditAvatarClick","e","handleAddPlaceClick","cardDelete","isOwn","newCards","filter","c","handleCardDelete","obj","handleCardLike","isLiked","some","i","newCard","handleUpdateUser","handleUpdateAvatar","avatar","handleAddPlaceSubmit","key","handleLogin","inputEmailValue","inputPassValue","authorize","data","push","handleRegister","register","signOut","localStorage","removeItem","tokenCheck","jwt","getItem","getContent"],"mappings":"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","sourcesContent":["import React, { useCallback } from \"react\";\nimport ImagePopup from \"./ImagePopup\";\nimport Confirm from \"./Confirm\";\nimport { getInitialCards, addNewCard, editUserInfo, getUserInfo, deleteCard, likeCard, deleteLikeCard,getLikesCard, setUserAvatar } from \"../utils/api\";\nimport Login from \"./Login\";\nimport Register from \"./Register\";\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport PageNotFound from \"./PageNotFound\";\nimport * as auth from \"../utils/auth\";\nimport InfoTooltip from \"./InfoTooltip\";\n\nimport { Route, Switch, useHistory } from \"react-router-dom\";\nimport Header from \"./Header\";\nimport Footer from \"./Footer\";\nimport Main from \"./Main\";\nimport EditProfilePopup from \"./EditProfilePopup\";\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport AddPlacePopup from \"./AddPlacePopup\";\n\nimport CurrentUserContext from \"../contexts/CurrentUserContext\";\n\nfunction App() {\n\n  const [isEditProfilePopupOpen, setEditProfilePopupState] = React.useState(\n    false\n  );\n  const [isEditAvatarPopupOpen, setEditAvatarPopupState] = React.useState(\n    false\n  );\n  const [isAddPlacePopupOpen, setAddPlacerPopupState] = React.useState(false);\n  const [isImagePopupOpen, setImagePopupState] = React.useState(false);\n  const [isConfirmOpen, setConfirmOpen] = React.useState(false);\n  const [isInfoTooltipOpen, setInfoTooltipOpen] = React.useState(false);\n  const [isConfirmAuth, setConfirmAuth] = React.useState(false);\n\n  const [cards, setCards] = React.useState([]);\n  const [isLoading, setIsLoading] = React.useState(false);\n  const [selectedCard, setSelectedCard] = React.useState({\n    src: \"\",\n    nameImg: \"\",\n  });\n  const [isLoadingConfirm, setIsLoadingConfirm] = React.useState(false);\n  const [isLoadingPopup, setIsLoadingPopup] = React.useState(false);\n\n  const [currentUser, setСurrentUser] = React.useState({ name: \"\", about: \"\", email: \"\", token: \"\" });\n  const [currentUserHeaders, setCurrentUserHeaders] = React.useState();\n\n  const [currentCard, setСurrentCard] = React.useState({\n    ownerId: \"\",\n    cardId: \"\",\n  });\n\n  // const [userData, setUserData] = React.useState({});\n\n  const [confirmAction, setConfirmAction] = React.useState({});\n\n  const history = useHistory();\n\n  const [loggedIn, setLoggedIn] = React.useState(false);\n\n\n  // React.useEffect(() => {\n  //   console.log('123123123123');\n  //   tokenCheck();\n  //   console.log()\n  // }, []);\n\n  React.useEffect(() => {\n      getUserInfo(currentUserHeaders)\n      .then((res) => {\n        setСurrentUser(res);\n      })\n      .catch((err) => {\n        console.log(err); // выведем ошибку в консоль\n      });\n  }, [currentUserHeaders]);\n\n  React.useEffect(() => {\n    getInitialCards(currentUserHeaders)\n    .then((res) => {\n      setCards(\n          res.map((item) => ({\n            src: item.link,\n            nameImg: item.name,\n            like: item.likes,\n            cardId: item._id,\n            ownerId: item.owner,\n          }))\n        );\n        setIsLoading(false);\n    })\n    .catch((err) => {\n      console.log(err); // выведем ошибку в консоль\n    });\n}, [currentUserHeaders]);\n\n\n\n  function closeAllPopups() {\n    setEditProfilePopupState(false);\n    setEditAvatarPopupState(false);\n    setAddPlacerPopupState(false);\n    setImagePopupState(false);\n    setInfoTooltipOpen(false);\n    setSelectedCard([]);\n    setIsLoadingPopup(false);\n    setСurrentCard({\n      ownerId: \"\",\n      cardId: \"\",\n    });\n  }\n\n  function handleCardClick({ src, nameImg }) {\n    setSelectedCard({ src, nameImg });\n    setImagePopupState(true);\n  }\n\n  function handleConfirmClick() {\n    setConfirmOpen(true);\n  }\n\n  function handleEditProfileClick(evt) {\n    evt.preventDefault();\n    setEditProfilePopupState(true);\n  }\n\n  function handleEditAvatarClick(e) {\n    e.preventDefault();\n    setEditAvatarPopupState(true);\n  }\n\n  function handleAddPlaceClick(evt) {\n    evt.preventDefault();\n    setAddPlacerPopupState(true);\n  }\n\n  function cardDelete() {\n    const isOwn = currentCard.ownerId === currentUser._id;\n    if (isOwn) {\n        deleteCard(currentCard.cardId, currentUserHeaders)\n        .then(() => {\n          const newCards = cards.filter((c) => c.cardId !== currentCard.cardId);\n          setCards(newCards);\n        })\n        .then(() => {\n          setConfirmOpen(false);\n          setIsLoadingConfirm(false);\n        })\n        .catch((err) => {\n          console.log(err); // выведем ошибку в консоль\n        });\n    }\n  }\n\n  function handleCardDelete(obj) {\n    setConfirmAction(\"cardDelete\");\n    setСurrentCard({\n      ownerId: obj.ownerId,\n      cardId: obj.cardId,\n    });\n  }\n\n  function handleCardLike(like, cardId) {\n    // Снова проверяем, есть ли уже лайк на этой карточке\n    const isLiked = like.some((i) => i === currentUser._id);\n    // console.log('main -> handleCardLike');\n    if (!isLiked) {\n      // console.log(\"main -> handleCardLike -> like\")\n      likeCard(cardId, currentUserHeaders)\n        .then((newCard) => {\n          const newCards = cards.map((c) =>\n            c.cardId === newCard._id\n              ? {\n                  src: newCard.link,\n                  nameImg: newCard.name,\n                  like: newCard.likes,\n                  cardId: newCard._id,\n                  ownerId: newCard.owner,\n                }\n              : c\n          );\n          setCards(newCards);\n        })\n        .catch((err) => {\n          console.log(err); // выведем ошибку в консоль\n        });\n    } else {\n      // console.log(\"main -> handleCardLike -> deleteLike\")\n      deleteLikeCard(cardId, currentUserHeaders)\n        .then((newCard) => {\n          const newCards = cards.map((c) =>\n            c.cardId === newCard._id\n              ? {\n                  src: newCard.link,\n                  nameImg: newCard.name,\n                  like: newCard.likes,\n                  cardId: newCard._id,\n                  ownerId: newCard.owner,\n                }\n              : c\n          );\n          setCards(newCards);\n        })\n        .catch((err) => {\n          console.log(err); // выведем ошибку в консоль\n        });\n    }\n  }\n\n  function handleUpdateUser(name, about) {\n    setIsLoadingPopup(true);\n    editUserInfo(name, about, currentUserHeaders)\n      .then((res) => setСurrentUser(res))\n      .then(() => {\n        setIsLoadingPopup(false);\n        setEditProfilePopupState(false);\n      })\n      .catch((err) => {\n        console.log(err); // выведем ошибку в консоль\n      });\n  }\n\n  function handleUpdateAvatar(obj) {\n    setIsLoadingPopup(true);\n    setUserAvatar(obj.avatar, currentUserHeaders)\n      .then((res) => setСurrentUser(res))\n      .then(() => {\n        setIsLoadingPopup(false);\n        setEditAvatarPopupState(false);\n      })\n      .catch((err) => {\n        console.log(err); // выведем ошибку в консоль\n      });\n  }\n\n  function handleAddPlaceSubmit(obj) {\n    setIsLoadingPopup(true);\n    addNewCard(obj.name, obj.link, currentUserHeaders)\n      .then((newCard) => {\n        newCard.key = newCard._id;\n        newCard.like = newCard.likes;\n        newCard.ownerId = newCard.owner;\n        newCard.src = newCard.link;\n        newCard.nameImg = newCard.name;\n        newCard.cardId = newCard._id;\n        setCards([newCard, ...cards]);\n      })\n      .then(() => {\n        setIsLoadingPopup(false);\n        setAddPlacerPopupState(false);\n      })\n      .catch((err) => {\n        console.log(err); // выведем ошибку в консоль\n      });\n  }\n\n  function handleLogin(inputEmailValue, inputPassValue) {\n    auth\n      .authorize(inputPassValue, inputEmailValue)\n      .then((data) => {\n        if (data.token) {\n          setLoggedIn(true);\n          // setUserData({ email: inputEmailValue });\n          setСurrentUser({ email: inputEmailValue });\n          setCurrentUserHeaders(data.token);\n          history.push(\"/\");\n        }\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }\n\n  function handleRegister(inputPassValue, inputEmailValue) {\n    auth\n      .register(inputPassValue, inputEmailValue)\n      .then((data) => {\n        if (data._id) {\n          setConfirmAuth(true);\n          history.push(\"/sign-in\");\n        }\n        setInfoTooltipOpen(true);\n      })\n      .catch((err) => {\n        console.log(err);\n        setConfirmAuth(false);\n        setInfoTooltipOpen(true);\n      });\n  }\n\n  function signOut() {\n    localStorage.removeItem(\"jwt\");\n    history.push(\"/sign-in\");\n  }\n\n  function tokenCheck () {\n    // если у пользователя есть токен в localStorage,\n    // эта функция проверит валидность токена\n    const jwt = localStorage.getItem(\"jwt\");\n    if (jwt) {\n      // проверим токен\n      auth\n        .getContent(jwt)\n        .then((res) => {\n          console.log(res);\n          if (res) {\n            // авторизуем пользователя\n            setLoggedIn(true);\n            // setUserData({ email: res.data.email });\n            setСurrentUser({ email: res.email });\n            setCurrentUserHeaders(jwt);\n            \n            // обернём App.js в withRouter\n            // так, что теперь есть доступ к этому методу\n            history.push(\"/\");\n          }\n        })\n        .catch((err) => {\n          console.log(err); // выведем ошибку в консоль\n        });\n    }\n  }\n\n  React.useEffect(() => {\n    setIsLoading(true);\n    tokenCheck();\n    getInitialCards(currentUserHeaders)\n      .then((res) => {\n        setCards(\n          res.map((item) => ({\n            src: item.link,\n            nameImg: item.name,\n            like: item.likes,\n            cardId: item._id,\n            ownerId: item.owner,\n          }))\n        );\n        setIsLoading(false);\n      })\n      .catch((err) => {\n        console.log(err); // выведем ошибку в консоль\n      });\n  }, []);\n\n  return (\n    <CurrentUserContext.Provider value={currentUser}>\n      <div className=\"App\">\n        <Header loggedIn={loggedIn} userData={currentUser} signOut={signOut} />\n        <Switch>\n          <ProtectedRoute\n            exact\n            path=\"/\"\n            component={Main}\n            loggedIn={loggedIn}\n            cards={cards}\n            onEditProfile={(e) => handleEditProfileClick(e)}\n            onEditAvatar={(e) => handleEditAvatarClick(e)}\n            onAddPlace={(e) => handleAddPlaceClick(e)}\n            onCardClick={handleCardClick}\n            setConfirmOpen={handleConfirmClick}\n            onCardLike={handleCardLike}\n            onCardDelete={handleCardDelete}\n            isLoading={isLoading}\n          />\n          <Route path=\"/sign-in\">\n            <Login onLogin={handleLogin} />\n          </Route>\n          <Route path=\"/sign-up\">\n            <Register onRegister={handleRegister} />\n          </Route>\n          {/* <Route>\n            {loggedIn ? <Redirect to=\"/\" /> : <Redirect to=\"/sign-in\" />}\n          </Route> */}\n          <Route path=\"*\">\n            <PageNotFound />\n          </Route>\n        </Switch>\n\n        <Footer />\n\n        <EditProfilePopup\n          isOpen={isEditProfilePopupOpen}\n          onClose={closeAllPopups}\n          onUpdateUser={handleUpdateUser}\n          isLoadingPopup={isLoadingPopup}\n        ></EditProfilePopup>\n        <EditAvatarPopup\n          isOpen={isEditAvatarPopupOpen}\n          onClose={closeAllPopups}\n          onUpdateAvatar={handleUpdateAvatar}\n          isLoadingPopup={isLoadingPopup}\n        ></EditAvatarPopup>\n        <AddPlacePopup\n          isOpen={isAddPlacePopupOpen}\n          onClose={closeAllPopups}\n          onAddPlace={handleAddPlaceSubmit}\n          isLoadingPopup={isLoadingPopup}\n        ></AddPlacePopup>\n\n        <Confirm\n          isOpen={isConfirmOpen}\n          setIsOpen={setConfirmOpen}\n          confirmAction={confirmAction}\n          setСurrentUser={setСurrentUser}\n          isLoadingConfirm={isLoadingConfirm}\n          setIsLoadingConfirm={setIsLoadingConfirm}\n          cardDelete={cardDelete}\n        />\n        <ImagePopup\n          card={selectedCard}\n          isOpen={isImagePopupOpen}\n          onClose={closeAllPopups}\n        />\n        <InfoTooltip\n          isOpen={isInfoTooltipOpen}\n          onClose={closeAllPopups}\n          isConfirmAuth={isConfirmAuth}\n        />\n      </div>\n    </CurrentUserContext.Provider>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}